// ============================================================
// Xray-core 完整客户端配置示例
// 功能：多出站代理、DNS 分流、路由分流（国内直连/国外代理）
// 支持：VLESS+REALITY / VLESS+WS+TLS / VMess+WS+TLS / Trojan+TLS
// ============================================================
{
  // ==================== 日志配置 ====================
  "log": {
    "loglevel": "warning",
    "dnsLog": false
  },

  // ==================== DNS 配置 ====================
  "dns": {
    "servers": [
      // 远程 DNS（通过代理查询，防止 DNS 污染）
      {
        "address": "https://1.1.1.1/dns-query",
        "domains": [
          "geosite:geolocation-!cn",
          "geosite:google",
          "geosite:facebook",
          "geosite:twitter",
          "geosite:telegram",
          "geosite:youtube",
          "geosite:netflix",
          "geosite:openai"
        ],
        "skipFallback": true,
        "tag": "dns-remote"
      },
      // 国内 DNS（直连查询）
      {
        "address": "https://223.5.5.5/dns-query",
        "domains": [
          "geosite:cn",
          "geosite:geolocation-cn",
          "geosite:apple-cn",
          "geosite:microsoft@cn",
          "geosite:category-games@cn"
        ],
        "expectedIPs": ["geoip:cn"],
        "skipFallback": true,
        "tag": "dns-direct"
      },
      // FakeDNS（配合透明代理使用，不需要可删除）
      // "fakedns",
      // 兜底
      {
        "address": "localhost",
        "skipFallback": false,
        "tag": "dns-local"
      }
    ],
    "hosts": {
      // 广告拦截
      "geosite:category-ads-all": "127.0.0.1"
    },
    "queryStrategy": "UseIP",
    "disableCache": false,
    "disableFallback": false,
    "disableFallbackIfMatch": true,
    "tag": "dns-inbound"
  },

  // ==================== 路由配置 ====================
  "routing": {
    "domainStrategy": "IPIfNonMatch",
    "rules": [
      // ----- DNS 路由 -----
      // DNS 远程查询走代理
      {
        "ruleTag": "dns-remote-out",
        "inboundTag": ["dns-remote"],
        "outboundTag": "proxy-vless-reality"
      },
      // DNS 国内查询走直连
      {
        "ruleTag": "dns-direct-out",
        "inboundTag": ["dns-direct"],
        "outboundTag": "direct"
      },

      // ----- 拦截规则 -----
      // 广告拦截
      {
        "ruleTag": "block-ads",
        "domain": [
          "geosite:category-ads-all"
        ],
        "outboundTag": "block"
      },
      // BT 下载拦截（可选，不需要可删除）
      {
        "ruleTag": "block-bt",
        "protocol": ["bittorrent"],
        "outboundTag": "direct"
      },

      // ----- 直连规则 -----
      // 私有地址直连
      {
        "ruleTag": "direct-private",
        "ip": [
          "geoip:private"
        ],
        "outboundTag": "direct"
      },
      // 中国大陆域名直连
      {
        "ruleTag": "direct-cn-domain",
        "domain": [
          "geosite:cn",
          "geosite:geolocation-cn",
          "geosite:apple-cn",
          "geosite:microsoft@cn",
          "geosite:category-games@cn",
          "geosite:tld-cn",
          "geosite:private"
        ],
        "outboundTag": "direct"
      },
      // 中国大陆 IP 直连
      {
        "ruleTag": "direct-cn-ip",
        "ip": [
          "geoip:cn",
          "223.5.5.5/32",
          "119.29.29.29/32",
          "180.76.76.76/32",
          "114.114.114.114/32"
        ],
        "outboundTag": "direct"
      },

      // ----- 代理规则 -----
      // 常见被墙域名强制代理
      {
        "ruleTag": "proxy-blocked",
        "domain": [
          "geosite:google",
          "geosite:facebook",
          "geosite:twitter",
          "geosite:telegram",
          "geosite:youtube",
          "geosite:netflix",
          "geosite:openai",
          "geosite:github",
          "domain:v2ex.com",
          "domain:t.me",
          "domain:pixiv.net"
        ],
        "outboundTag": "proxy-vless-reality"
      },
      // Telegram IP 段代理
      {
        "ruleTag": "proxy-telegram-ip",
        "ip": [
          "149.154.160.0/20",
          "91.108.4.0/22",
          "91.108.8.0/22",
          "91.108.12.0/22",
          "91.108.16.0/22",
          "91.108.20.0/22",
          "91.108.56.0/22",
          "95.161.64.0/20",
          "2001:67c:4e8::/48",
          "2001:b28:f23d::/48",
          "2001:b28:f23f::/48"
        ],
        "outboundTag": "proxy-vless-reality"
      },

      // ----- 端口规则 -----
      // DNS 端口走 DNS 出站
      {
        "ruleTag": "dns-hijack",
        "port": 53,
        "outboundTag": "dns-out"
      }

      // ----- 未匹配流量 -----
      // 未匹配流量走第一个出站（proxy-vless-reality）
    ]
  },

  // ==================== 入站配置 ====================
  "inbounds": [
    // ----- SOCKS5 代理入站 -----
    {
      "tag": "socks-in",
      "protocol": "socks",
      "port": 10808,
      "listen": "127.0.0.1",
      "settings": {
        "auth": "noauth",
        "udp": true
      },
      "sniffing": {
        "enabled": true,
        "destOverride": ["http", "tls", "quic"],
        "routeOnly": false
      }
    },

    // ----- HTTP 代理入站 -----
    {
      "tag": "http-in",
      "protocol": "http",
      "port": 10809,
      "listen": "127.0.0.1",
      "settings": {
        "allowTransparent": false
      },
      "sniffing": {
        "enabled": true,
        "destOverride": ["http", "tls"]
      }
    }

    // ----- 透明代理入站 (Linux tproxy，Windows/macOS 不适用) -----
    // {
    //   "tag": "tproxy-in",
    //   "protocol": "dokodemo-door",
    //   "port": 12345,
    //   "listen": "0.0.0.0",
    //   "settings": {
    //     "network": "tcp,udp",
    //     "followRedirect": true
    //   },
    //   "streamSettings": {
    //     "sockopt": {
    //       "tproxy": "tproxy",
    //       "mark": 255
    //     }
    //   },
    //   "sniffing": {
    //     "enabled": true,
    //     "destOverride": ["http", "tls", "quic"],
    //     "routeOnly": false
    //   }
    // }
  ],

  // ==================== 出站配置 ====================
  "outbounds": [
    // ===== 1. VLESS + Vision + REALITY（主力代理，推荐）=====
    {
      "tag": "proxy-vless-reality",
      "protocol": "vless",
      "settings": {
        "vnext": [
          {
            "address": "your-server-ip-or-domain",
            "port": 443,
            "users": [
              {
                "id": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
                "flow": "xtls-rprx-vision",
                "encryption": "none",
                "level": 0
              }
            ]
          }
        ]
      },
      "streamSettings": {
        "network": "tcp",
        "security": "reality",
        "realitySettings": {
          "fingerprint": "chrome",
          "serverName": "www.microsoft.com",
          "publicKey": "YOUR_X25519_PUBLIC_KEY",
          "shortId": "0123456789abcdef",
          "spiderX": "/"
        }
      }
    },

    // ===== 2. VLESS + WebSocket + TLS（CDN 中转）=====
    {
      "tag": "proxy-vless-ws",
      "protocol": "vless",
      "settings": {
        "vnext": [
          {
            "address": "your-cdn-domain.com",
            "port": 443,
            "users": [
              {
                "id": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
                "encryption": "none",
                "level": 0
              }
            ]
          }
        ]
      },
      "streamSettings": {
        "network": "ws",
        "security": "tls",
        "tlsSettings": {
          "serverName": "your-cdn-domain.com",
          "fingerprint": "chrome",
          "allowInsecure": false
        },
        "wsSettings": {
          "path": "/your-secret-ws-path",
          "headers": {
            "Host": "your-cdn-domain.com"
          }
        }
      }
    },

    // ===== 3. VMess + WebSocket + TLS =====
    {
      "tag": "proxy-vmess-ws",
      "protocol": "vmess",
      "settings": {
        "vnext": [
          {
            "address": "your-vmess-server.com",
            "port": 443,
            "users": [
              {
                "id": "yyyyyyyy-yyyy-yyyy-yyyy-yyyyyyyyyyyy",
                "security": "auto",
                "level": 0
              }
            ]
          }
        ]
      },
      "streamSettings": {
        "network": "ws",
        "security": "tls",
        "tlsSettings": {
          "serverName": "your-vmess-server.com",
          "fingerprint": "chrome"
        },
        "wsSettings": {
          "path": "/your-vmess-ws-path",
          "headers": {
            "Host": "your-vmess-server.com"
          }
        }
      }
    },

    // ===== 4. Trojan + TLS =====
    {
      "tag": "proxy-trojan",
      "protocol": "trojan",
      "settings": {
        "servers": [
          {
            "address": "your-trojan-server.com",
            "port": 443,
            "password": "your-trojan-password",
            "level": 0
          }
        ]
      },
      "streamSettings": {
        "network": "tcp",
        "security": "tls",
        "tlsSettings": {
          "serverName": "your-trojan-server.com",
          "fingerprint": "chrome",
          "allowInsecure": false
        }
      }
    },

    // ===== 5. Shadowsocks 2022 =====
    {
      "tag": "proxy-ss",
      "protocol": "shadowsocks",
      "settings": {
        "servers": [
          {
            "address": "your-ss-server.com",
            "port": 8388,
            "method": "2022-blake3-aes-128-gcm",
            "password": "YOUR_BASE64_KEY_HERE",
            "level": 0
          }
        ]
      }
    },

    // ===== 6. WireGuard (如 Cloudflare WARP) =====
    // {
    //   "tag": "proxy-warp",
    //   "protocol": "wireguard",
    //   "settings": {
    //     "secretKey": "your-wireguard-private-key",
    //     "address": [
    //       "172.16.0.2/32",
    //       "2606:4700:110:8a36:df92:102a:9602:fa18/128"
    //     ],
    //     "peers": [
    //       {
    //         "publicKey": "bmXOC+F1FxEMF9dyiK2H5/1SUtzH0JuVo51h2wPfgyo=",
    //         "endpoint": "engage.cloudflareclient.com:2408",
    //         "allowedIPs": ["0.0.0.0/0", "::/0"],
    //         "keepAlive": 30
    //       }
    //     ],
    //     "mtu": 1280,
    //     "reserved": [0, 0, 0],
    //     "domainStrategy": "ForceIPv4v6"
    //   }
    // },

    // ===== 直连出站 =====
    {
      "tag": "direct",
      "protocol": "freedom",
      "settings": {
        "domainStrategy": "AsIs"
      }
    },

    // ===== 黑洞出站（拦截） =====
    {
      "tag": "block",
      "protocol": "blackhole",
      "settings": {
        "response": {
          "type": "http"
        }
      }
    },

    // ===== DNS 出站 =====
    {
      "tag": "dns-out",
      "protocol": "dns",
      "settings": {
        "nonIPQuery": "drop"
      }
    }
  ]
}
